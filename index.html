<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    <meta name="description"
        content="Jouez √† Flappy Savon et tentez de gagner des savons artisanaux Savon Yvard ! Entrez dans le Top 3 du concours." />
    <meta name="theme-color" content="#f5f0e8" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta property="og:title" content="Flappy Savon ‚Äì Concours Savon Yvard" />
    <meta property="og:description" content="Jouez et gagnez des savons artisanaux !" />
    <meta property="og:type" content="website" />
    <link rel="manifest" href="manifest.json" />
    <link rel="apple-touch-icon" href="assets/icon-192.png" />
    <title>Flappy Savon ‚Äì Concours Savon Yvard</title>
    <link rel="stylesheet" href="css/styles.css" />
</head>

<body>
    <div class="wrap">
        <canvas id="game" width="420" height="700" role="img"
            aria-label="Jeu Flappy Savon ‚Äì Appuyez pour sauter"></canvas>

        <!-- Top Bar: Score + Menu -->
        <div class="top-bar">
            <div class="score-display">
                <span class="current-score" id="score">0</span>
                <span class="best-score"><svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        style="vertical-align: -2px;">
                        <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" />
                        <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" />
                        <path d="M4 22h16" />
                        <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" />
                        <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" />
                        <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" />
                    </svg> <span id="best">0</span></span>
            </div>
            <button id="menuBtn" class="menu-btn" aria-label="Menu">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="4" y1="12" x2="20" y2="12"></line>
                    <line x1="4" y1="6" x2="20" y2="6"></line>
                    <line x1="4" y1="18" x2="20" y2="18"></line>
                </svg>
            </button>
        </div>

        <!-- Discreet countdown at bottom -->
        <div class="countdown-bar" id="countdownBar">
            <span id="countdown">Fin dans --j</span>
        </div>

    </div>

    <!-- Menu Drawer -->
    <div id="menuDrawer" class="menu-drawer">
        <div class="drawer-header">
            <h3>Menu</h3>
            <button id="menuClose" class="close-btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="drawer-content">
            <button id="leaderBtn" class="drawer-item">
                <span class="item-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
                        <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
                        <path d="M4 22h16"></path>
                        <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
                        <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
                        <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
                    </svg>
                </span>
                <span>Classement</span>
            </button>
            <button id="idBtn" class="drawer-item">
                <span class="item-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </span>
                <span>Mon compte</span>
            </button>
            <button id="skinBtn" class="drawer-item">
                <span class="item-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="13.5" cy="6.5" r=".5"></circle>
                        <circle cx="17.5" cy="10.5" r=".5"></circle>
                        <circle cx="8.5" cy="7.5" r=".5"></circle>
                        <circle cx="6.5" cy="12.5" r=".5"></circle>
                        <path
                            d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z">
                        </path>
                    </svg>
                </span>
                <span>Skins</span>
            </button>
            <button id="shareBtn" class="drawer-item">
                <span class="item-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                        <polyline points="16 6 12 2 8 6"></polyline>
                        <line x1="12" y1="2" x2="12" y2="15"></line>
                    </svg>
                </span>
                <span>Partager</span>
            </button>
            <button id="muteBtn" class="drawer-item">
                <span class="item-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                    </svg>
                </span>
                <span>Son</span>
            </button>
            <button id="installBtn" class="drawer-item" style="display: none; background: #e0f0ff; color: #0066cc;">
                <span class="item-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </span>
                <span>Installer l'app</span>
            </button>
            <a href="https://savon-yvard.fr/" target="_blank" class="drawer-item"
                style="text-decoration: none; color: inherit;">
                <span class="item-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <path d="M16 10a4 4 0 0 1-8 0"></path>
                    </svg>
                </span>
                <span>Boutique</span>
            </a>

            <p
                style="margin-top: 20px; font-style: italic; font-size: 13px; color: #8d7b6f; text-align: center; padding: 0 10px;">
                "La vie est une belle bulle : √©ph√©m√®re, mais brillante."
            </p>

            <a href="https://savon-yvard.fr/" target="_blank" class="brand-logo">SAVON YVARD</a>
        </div>
    </div>
    <div id="menuOverlay" class="menu-overlay"></div>

    <!-- ... (existing modals) ... -->

    <!-- iOS Install Instructions Modal -->
    <div id="iosInstallModal" class="modal" aria-hidden="true">
        <div class="card" style="text-align: center;">
            <button id="iosClose" class="close-btn" aria-label="Fermer">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <h2>Installer sur iPhone</h2>
            <p style="margin-bottom: 20px;">Pour avoir le jeu en plein √©cran :</p>
            <ol
                style="text-align: left; margin: 0 auto; display: inline-block; padding-left: 20px; font-size: 15px; line-height: 1.6;">
                <li>Appuyez sur <strong>Partager</strong> <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" style="vertical-align: -2px;">
                        <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8" />
                        <polyline points="16 6 12 2 8 6" />
                        <line x1="12" y1="2" x2="12" y2="15" />
                    </svg></li>
                <li>D√©filez vers le bas</li>
                <li>Touchez <strong>Sur l'√©cran d'accueil</strong> <svg width="16" height="16" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: -2px;">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                        <line x1="12" y1="8" x2="12" y2="16" />
                        <line x1="8" y1="12" x2="16" y2="12" />
                    </svg></li>
            </ol>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <!-- Guest Reminder -->
    <div id="reminder" class="reminder">
        <button id="reminderClose" class="reminder-close" aria-label="Fermer">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        <span><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px;">
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" />
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" />
                <path d="M4 22h16" />
                <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" />
                <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" />
                <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" />
            </svg> Inscris-toi pour enregistrer ton score au classement !</span>
        <button id="reminderBtn" class="btn">S'inscrire</button>
    </div>

    <!-- Identity / Onboarding Modal -->
    <div id="idModal" class="modal" aria-hidden="true">
        <div class="card">
            <button id="idClose" class="close-btn" aria-label="Fermer">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <h2>üéÆ Flappy Savon</h2>
            <p class="subtitle"><span id="countdown">‚è≥ -- jours</span> ‚Ä¢ Entre dans le Top 3 !</p>

            <div class="tabs">
                <button class="tab-btn active" data-tab="register">Inscription</button>
                <button class="tab-btn" data-tab="ranking"><svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        style="vertical-align: -2px;">
                        <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" />
                        <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" />
                        <path d="M4 22h16" />
                        <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" />
                        <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" />
                        <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" />
                    </svg> Classement</button>
                <button class="tab-btn" data-tab="prizes">üéÅ Lots</button>
                <button class="tab-btn" data-tab="promo">üéüÔ∏è Promo</button>
            </div>

            <div id="tab-register" class="tab-content active">
                <div class="row">
                    <input id="pseudo" type="text" placeholder="Ton pseudo" maxlength="24" autocomplete="nickname" />
                </div>
                <div class="row">
                    <input id="email" type="email" placeholder="Ton e-mail" autocomplete="email" />
                    <p class="email-hint">üì¨ Tes r√©compenses seront envoy√©es par email</p>
                </div>
                <div class="row inline">
                    <input id="optin" type="checkbox" />
                    <label for="optin">J'accepte les e-mails Savon Yvard</label>
                </div>
                <!-- Action button stays inside the register tab or outside? Usually better inside if it submits the form. 
                     The original 'Participer' button was outside. I will keep it inside 'register' tab for context, 
                     or keep it global but change text? 
                     The 'Participer' button saves identity. It only makes sense in 'register' tab.
                -->
                <button id="idSaveBtn" class="btn full">Participer</button>
                <button id="idGuestBtn" class="skip-link">Jouer sans participer ‚Üí</button>
            </div>

            <div id="tab-ranking" class="tab-content">
                <div id="modalLeaderboard" class="modal-leaderboard">
                    <div class="muted">Chargement...</div>
                </div>
            </div>

            <div id="tab-prizes" class="tab-content">
                <p class="muted" style="margin-bottom: 12px; text-align: center; font-size: 13px;">
                    üìÖ <strong>Fin du concours : 31 janvier.</strong><br>
                    Les lots seront attribu√©s aux 3 meilleurs scores √† cette date !
                </p>
                <ul class="prize-list">
                    <li><span class="medal">ü•á</span> <strong>Top 1 :</strong> 1 Savon + 1 Shampoing + 1 D√©o</li>
                    <li><span class="medal">ü•à</span> <strong>Top 2 :</strong> 1 Savon + 1 Shampoing</li>
                    <li><span class="medal">ü•â</span> <strong>Top 3 :</strong> 1 Savon offert</li>
                </ul>
            </div>

            <div id="tab-promo" class="tab-content">
                <div class="promo-list">
                    <div class="promo-item" data-threshold="10">
                        <div class="threshold">Passer 10 pts</div>
                        <div class="code-display">Bloqu√© üîí</div>
                        <div class="discount">-10%</div>
                    </div>
                    <div class="promo-item" data-threshold="20">
                        <div class="threshold">Passer 20 pts</div>
                        <div class="code-display">Bloqu√© üîí</div>
                        <div class="discount">-15%</div>
                    </div>
                    <div class="promo-item" data-threshold="30">
                        <div class="threshold">Passer 30 pts</div>
                        <div class="code-display">Bloqu√© üîí</div>
                        <div class="discount">-20%</div>
                    </div>
                </div>
            </div>

            <p class="legal"><a href="https://savon-yvard.fr/politique-de-confidentialite/" target="_blank">Politique de
                    confidentialit√©</a></p>
        </div>
    </div>

    <!-- Skins Modal -->
    <div id="skinModal" class="modal" aria-hidden="true">
        <div class="card">
            <button id="skinClose" class="close-btn" aria-label="Fermer">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <h2>Choisis ton savon</h2>
            <p class="muted"></p>
            <div class="skins" id="skins"></div>
        </div>
    </div>

    <!-- Unlock Modal -->
    <div id="unlockModal" class="modal" aria-hidden="true">
        <div class="card" style="text-align: center; padding-top: 40px;">
            <div id="unlockIcon" style="font-size: 64px; margin-bottom: 20px;">üßº</div>
            <h2 style="font-size: 28px; margin-bottom: 8px;">Nouveau Savon !</h2>
            <p id="unlockName" style="font-size: 18px; font-weight: 600; margin-bottom: 24px; color: var(--ink);">Savon
                Myst√®re</p>
            <button id="equipBtn" class="btn full">√âquiper maintenant</button>
            <button id="unlockClose" class="skip-link">Plus tard</button>
        </div>
    </div>

    <!-- Leaderboard -->
    <div id="leader" class="leader">
        <button id="leaderClose" class="close-btn" aria-label="Fermer"
            style="top:8px; right:8px; width:24px; height:24px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        <h3>üèÜ Top 10 (concours)</h3>
        <div id="leaderRows"></div>
        <div class="muted" id="leaderMeta"></div>
    </div>

    <!-- Prize Popup -->
    <div id="prize" class="prize">
        <img id="prizeImg" alt="Lot" />
        <div class="txt" id="prizeTxt"></div>
    </div>

    <!-- Scripts (order matters) -->
    <script src="js/config.js"></script>
    <script src="js/security.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/particles.js"></script>
    <script src="js/renderer.js"></script>
    <script src="js/resize.js"></script>
    <script src="js/supabase.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/game.js"></script>
    <script src="js/main.js"></script>
    <script src="js/pwa.js"></script>
    <script>
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(() => console.log('[PWA] Service Worker registered'))
                .catch((err) => console.log('[PWA] SW registration failed:', err));
        }
    </script>
</body>

</html>